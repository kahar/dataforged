<head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/showdown/1.9.1/showdown.min.js"></script>
    <script src='https://cdn.jsdelivr.net/npm/showdown-table@1.0.1/dist/showdown-table.min.js'></script>
</head>

<style>
/* Style the tab */

body, html {
  height: 100%;
  margin: 0;
  font-family: Arial;
}

.tab {
  overflow: hidden;
  border: 1px solid #ccc;
  background-color: #f1f1f1;
}

/* Style the buttons inside the tab */
.tab button {
  background-color: inherit;
  float: left;
  border: none;
  outline: none;
  cursor: pointer;
  padding: 14px 16px;
  transition: 0.3s;
  font-size: 17px;
}

/* Change background color of buttons on hover */
.tab button:hover {
  background-color: #ddd;
}

/* Create an active/current tablink class */
.tab button.active {
  background-color: #ccc;
}

/* Style the tab content */
.tabcontent {
  display: none;
  padding: 6px 12px;
  border: 1px solid #ccc;
  border-top: none;
}

/* The Modal (background) */
.modal {
  display: none; /* Hidden by default */
  position: fixed; /* Stay in place */
  z-index: 1; /* Sit on top */
  left: 0;
  top: 0;
  width: 100%; /* Full width */
  height: 100%; /* Full height */
  overflow: auto; /* Enable scroll if needed */
  background-color: rgb(0,0,0); /* Fallback color */
  background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
}

/* Modal Content */
.modal-content {
  background-color: #fefefe;
  margin: auto;
  padding: 20px;
  border: 1px solid #888;
  width: 80%;
}

/* The Close Button */
.close {
  color: #aaaaaa;
  float: right;
  font-size: 28px;
  font-weight: bold;
}

.close:hover,
.close:focus {
  color: #000;
  text-decoration: none;
  cursor: pointer;
}

.modal-content {
  font-size:3vw;
}
/*oracle row to roll*/
.oracle-row-to-roll {
    font-size:3vw;
}
</style>

<body>
<div id="myModal" class="modal">

<!-- Modal content -->
<div class="modal-content">
    <span class="close">&times;</span>
    <p class="modal-content-txt">Some text in the Modal..</p>
    <button onclick="addToLocalStoreHistory()">Add to history</button>
</div>

</div>
<div class="tab">
    <button class="tablinks" onclick="openTab(event, 'moves')">Moves</button>
    <button class="tablinks" onclick="openTab(event, 'assets')">Assets</button>
    <button class="tablinks" onclick="openTab(event, 'oracles')">Oracles</button>
    <button class="tablinks" onclick="openTab(event, 'roll_oracles')">Roll Oracles</button>
    <button class="tablinks" onclick="openTab(event, 'roll_oracles_history')">History</button>

</div>
<div id="moves" class="tabcontent">
    <div id="moves_list"></div>>
</div>
<div id="assets" class="tabcontent">
    <div id="assets_list">
    </div>
</div>
<div id="oracles" class="tabcontent">
    <div id="oracles_list">
    </div>
</div>

<div id="roll_oracles" class="tabcontent">
    <div id="roll_oracles_list">
    </div>
    <p class="oracle-row-to-roll" onclick='createCharacter()'>Character</p>
    <p class="oracle-row-to-roll" onclick='createCharacterCreation()'>Character creation</p>
    <p class="oracle-row-to-roll" onclick='rollActionAndTheme()'>Core - Action and Theme</p>
    <p class="oracle-row-to-roll" onclick='rollDescriptorAndFocus()'>Core - Descriptor and Focus</p>
    <p class="oracle-row-to-roll" onclick='createCreature()'>Creature</p>
    <p class="oracle-row-to-roll" onclick='createSpaceCreature()'>Creature - Space</p>
    <p class="oracle-row-to-roll" onclick='createInteriorCreature()'>Creature - Interior</p>
    <p class="oracle-row-to-roll" onclick='createLandCreature()'>Creature - Land</p>
    <p class="oracle-row-to-roll" onclick='createLiquidCreature()'>Creature - Liquid</p>
    <p class="oracle-row-to-roll" onclick='createAirCreature()'>Creature - Air</p>
    <p class="oracle-row-to-roll" onclick='createDerelict()'>Derelict - initial creation</p>
    <p class="oracle-row-to-roll" onclick='displayInModal(createZoneStarship())'>Derelict - zone in starship</p>
    <p class="oracle-row-to-roll" onclick='displayInModal(createZoneSettlement())'>Derelict - zone in settlement</p>
    <p class="oracle-row-to-roll" onclick='displayInModal(createDerelictFeaturesByZone("Access"))'>Derelict - Zone - Access</p>
    <p class="oracle-row-to-roll" onclick='displayInModal(createDerelictFeaturesByZone("Community"))'>Derelict - Zone - Community</p>
    <p class="oracle-row-to-roll" onclick='displayInModal(createDerelictFeaturesByZone("Engineering"))'>Derelict - Zone - Engineering</p>
    <p class="oracle-row-to-roll" onclick='displayInModal(createDerelictFeaturesByZone("Living"))'>Derelict - Zone - Living</p>
    <p class="oracle-row-to-roll" onclick='displayInModal(createDerelictFeaturesByZone("Medical"))'>Derelict - Zone - Medical</p>
    <p class="oracle-row-to-roll" onclick='displayInModal(createDerelictFeaturesByZone("Operations"))'>Derelict - Zone - Operations</p>
    <p class="oracle-row-to-roll" onclick='displayInModal(createDerelictFeaturesByZone("Production"))'>Derelict - Zone - Production</p>
    <p class="oracle-row-to-roll" onclick='displayInModal(createDerelictFeaturesByZone("Research"))'>Derelict - Zone - Research</p>
    <p class="oracle-row-to-roll" onclick='createLocation()'>Location</p>
    <p class="oracle-row-to-roll" onclick='displayInModal(createLocationFeaturesByTheme("Chaotic"))'>Location - Theme - Chaotic</p>
    <p class="oracle-row-to-roll" onclick='displayInModal(createLocationFeaturesByTheme("Fortified"))'>Location - Theme - Fortified</p>
    <p class="oracle-row-to-roll" onclick='displayInModal(createLocationFeaturesByTheme("Haunted"))'>Location - Theme - Haunted</p>
    <p class="oracle-row-to-roll" onclick='displayInModal(createLocationFeaturesByTheme("Infested"))'>Location - Theme - Infested</p>
    <p class="oracle-row-to-roll" onclick='displayInModal(createLocationFeaturesByTheme("Inhabited"))'>Location - Theme - Inhabited</p>
    <p class="oracle-row-to-roll" onclick='displayInModal(createLocationFeaturesByTheme("Ruined"))'>Location - Theme - Ruined</p>
    <p class="oracle-row-to-roll" onclick='displayInModal(createLocationFeaturesByTheme("Sacred"))'>Location - Theme - Sacred</p>
    <p class="oracle-row-to-roll" onclick='displayInModal(rollOnOracle(oracles.Miscellaneous.Story_Complication))'>Miscellaneous - Story Complication</p>
    <p class="oracle-row-to-roll" onclick='displayInModal(rollOnOracle(oracles.Miscellaneous.Combat_Action))'>Miscellaneous - Story Combat Action</p>
    <p class="oracle-row-to-roll" onclick='displayInModal(rollOnOracle(oracles.Miscellaneous.Anomaly_Effect))'>Miscellaneous - Anomaly Effect</p>

    <p class="oracle-row-to-roll" onclick='todo()'>TODO Move</p>

    <p class="oracle-row-to-roll" onclick='createPlanet()'>Planet</p>
    <p class="oracle-row-to-roll" onclick='todo()'>Planet - TODO add for every type</p>
    <p class="oracle-row-to-roll" onclick='createPrecursorVault()'>Precursor Vault</p>
    <p class="oracle-row-to-roll" onclick='createInteriorPrecursorVault()'>Precursor Vault - Interior</p>
    <p class="oracle-row-to-roll" onclick='createSanctumPrecursorVault()'>Precursor Vault - Sanctum</p>
    <p class="oracle-row-to-roll" onclick='createSettlement()'>Settlement</p>
    <p class="oracle-row-to-roll" onclick='displayInModal(rollOnOracle(oracles.Space.Space_Sighting))'>Space - Sighting</p>
    <p class="oracle-row-to-roll" onclick='displayInModal(rollOnOracle(oracles.Space.Stellar_Object))'>Space - Stellar Object</p>
    <p class="oracle-row-to-roll" onclick='createSectorName()'>Space - Sector Name</p>
    <p class="oracle-row-to-roll" onclick='displayInModal(rollOnOracle(oracles.Space.Peril))'>Space - Peril</p>
    <p class="oracle-row-to-roll" onclick='createStarship()'>Starship</p>
</div>

<div id="roll_oracles_history" class="tabcontent">
    <button onclick="showLocalStoreHistory()">Show history</button>
    <button onclick="clearLocalStoreHistory()">Clear history</button>
</div>

</body>

<script>
var BACKGROUND_COLOR_1 = 'lightyellow'
var BACKGROUND_COLOR_2 = 'lightblue'
var BACKGROUND_COLOR_3 = 'lightcoral'
var BACKGROUND_COLOR_4 = 'lightgreen'
var BACKGROUND_COLOR_5 = 'lightcyan'
var BACKGROUND_COLOR_6 = 'lightsalmon'
var BACKGROUND_COLOR_7 = 'lightskyblue'
var BACKGROUND_COLOR_8 = 'lightpink'
var BACKGROUND_COLOR_9 = 'yellow'
var BACKGROUND_COLOR_10 = 'coral'
var BACKGROUND_COLOR_11 = 'cyan'
/*Tabs part*/
function openTab(evt, tabName) {
    var i, tabcontent, tablinks;
    tabcontent = document.getElementsByClassName("tabcontent");
    for (var i = 0; i < tabcontent.length; i++) {
        tabcontent[i].style.display = "none";
    }
    tablinks = document.getElementsByClassName("tablinks");
    for (var i = 0; i < tablinks.length; i++) {
        tablinks[i].className = tablinks[i].className.replace(" active", "");
    }
    document.getElementById(tabName).style.display = "block";
    evt.currentTarget.className += " active";
}
/*markdown to html converter*/
var converter = new showdown.Converter({
    extensions: ['table']
});
/*other*/
function hideSubElements(el) {
    var element = $(el).parent().find('#subelements');

    if (element.is(":visible")) {
        element.hide();
    } else {
        element.show();
    }
}

function toId(txt) {
    return (txt).replace(/\s+/g, '-').replace('/', '\\/');
}

function spaceToUnderscore(txt) {
    return (txt).replace(/\s+/g, '_');
}

function cleanText(txt) {
    return txt.replace(/[^0-9a-z\s]/gi, '');
}

function getNameOrDisplayName(obj) {
    return obj.Name != null ? obj.Name : obj["Display name"];
}

function pickRandomFromJsArray(t) {
    return t[Math.floor(Math.random() * t.length)];
}

/*moves part*/
$.getJSON("https://raw.githubusercontent.com/rsek/dataforged/main/moves.json")
    .done(function(data) {
        var moves = data.Moves;
        var movesTypes = [];
        for (var i = 0; i < moves.length; i++) {
            var move = moves[i];
            if (movesTypes[move.Category] != null) {
                movesTypes[move.Category].push(move);
            } else {
                movesTypes[move.Category] = [];
                movesTypes[move.Category].push(move);
            }
        }

        for (const category in movesTypes) {
            var moveType = movesTypes[category];
            var divToAppend = '<div id="' + toId(category) + '" ><div onclick="hideSubElements(this)">' + converter.makeHtml('##' + category) + '</div><div id="subelements"></div></div>'
            $("#moves_list").append(divToAppend);
            for (var i = 0; i < moveType.length; i++) {
                var move = moveType[i];
                var liToAppend = '<div id=' + toId(move.Name) + '>' + converter.makeHtml('###' + move.Name + '\n' + move.Text) + '</div>';

                $("#" + toId(category) + " #subelements").append(liToAppend);
            }
        }
    });
/*assets part*/
$.getJSON("https://raw.githubusercontent.com/rsek/dataforged/main/assets.json")
    .done(function(data) {
        var assets = data.Assets;
        var assetsTypes = [];
        for (var i = 0; i < assets.length; i++) {
            var asset = assets[i];
            if (assetsTypes[asset.Category] != null) {
                assetsTypes[asset.Category].push(asset);
            } else {
                assetsTypes[asset.Category] = [];
                assetsTypes[asset.Category].push(asset);
            }
        }

        for (const category in assetsTypes) {
            var assetType = assetsTypes[category];
            var divToAppend = '<div id="' + toId(category) + '" ><div onclick="hideSubElements(this)">' + converter.makeHtml('##' + category) + '</div><div id="subelements"></div></div>'
            $("#assets_list").append(divToAppend);
            for (var i = 0; i < assetType.length; i++) {
                var asset = assetType[i];

                var liToAppend = '<div id=' + toId(asset.Name) + '>' + converter.makeHtml('###' + asset.Name +
                        (asset.Description != null ? ('\n' + asset.Description + '\n') : '\n')) +
                    '<div>' +
                    '<input type="checkbox" disabled ' + (asset.Abilities[0].Enabled == true ? 'checked' : '') + '>' + converter.makeHtml(asset.Abilities[0].Text) +
                    '<input type="checkbox" disabled ' + (asset.Abilities[1].Enabled == true ? 'checked' : '') + '>' + converter.makeHtml(asset.Abilities[1].Text) +
                    '<input type="checkbox" disabled ' + (asset.Abilities[2].Enabled == true ? 'checked' : '') + '>' + converter.makeHtml(asset.Abilities[2].Text) +
                    '</div>' +
                    '</div>';

                $("#" + toId(category) + " #subelements").append(liToAppend);
            }
        }
    });

function parseSubOracle(oracle, subOracle) {
    oracle[spaceToUnderscore(getNameOrDisplayName(subOracle))] = subOracle;
    if (subOracle["Display name"] == null) {
        subOracle["Display name"] = subOracle.Name;
    }
    var liToAppend = '<div id="' + toId(subOracle["Display name"]) + '"><div onclick="hideSubElements(this)">' + converter.makeHtml('###' + subOracle["Display name"]) +
        '</div>' + '<div id="subelements"></div>' +
        '</div>';
    $("#" + toId(oracle["Display name"]) + " #subelements").first().append(liToAppend);
    if (subOracle.Table != null) {
        for (var z = 0; z < subOracle.Table.length; z++) {
            var tableElementToAppend = '<div>' + subOracle.Table[z].Chance + ' ' + subOracle.Table[z].Description + '</div>'
            $("#" + toId(subOracle["Display name"]) + " #subelements").append(tableElementToAppend);
        }
    }
    if (subOracle.Tables != null) {
        for (var z = 0; z < subOracle.Tables.length; z++) {
            var subSubOracle = subOracle.Tables[z];
            parseSubOracle(subOracle, subSubOracle);
        }
    }
    if (subOracle.Oracles != null) {
        for (var z = 0; z < subOracle.Oracles.length; z++) {
            var subSubOracle = subOracle.Oracles[z];
            parseSubOracle(subOracle, subSubOracle);
        }
    }
}

/*oracles*/
var oracles = {};
$.getJSON("https://raw.githubusercontent.com/rsek/dataforged/main/oracles.json")
    .done(function(data) {
        oracles = data;
        for (var i = 0; i < data.length; i++) {
            var oracle = data[i];
            // parseOracle(oracles, oracle)
            oracles[spaceToUnderscore(getNameOrDisplayName(oracle))] = oracle;
            if (oracle["Display name"] == null) {
                oracle["Display name"] = oracle.Name;
            }
            var divToAppend = '<div id="' + toId(oracle["Display name"]) + '" ><div onclick="hideSubElements(this)">' + converter.makeHtml('##' + oracle["Display name"]) + '</div><div id="subelements"></div></div>'
            $("#oracles_list").append(divToAppend);
            for (var j = 0; j < oracle.Oracles.length; j++) {
                var subOracle = oracle.Oracles[j];
                parseSubOracle(oracle, subOracle);
            }
            if (oracle.Subcategories != null) {
                for (var z = 0; z < oracle.Subcategories.length; z++) {
                    var subOracle = oracle.Subcategories[z];
                    parseSubOracle(oracle, subOracle);
                }
            }
        }
    });

/*local storage*/
var modal = document.getElementById("myModal");
var span = document.getElementsByClassName("close")[0];
var content = document.getElementsByClassName("modal-content-txt")[0];

span.onclick = function() {
    modal.style.display = "none";
}

window.onclick = function(event) {
    if (event.target == modal) {
        modal.style.display = "none";
    }
}

function displayInModal(newContent) {
    content.innerHTML = newContent;
    modal.style.display = "block";
}

function addToLocalStoreHistory() {
    var currentHistory = JSON.parse(localStorage.getItem("history"));
    currentHistory.push(document.getElementsByClassName("modal-content-txt")[0].innerHTML);

    localStorage.setItem("history", JSON.stringify(currentHistory));

}

function showLocalStoreHistory() {
    var array = JSON.parse(localStorage.getItem("history"));
    var strToDisplay = "";
    for (var i = 0; i < array.length; i++) {
        strToDisplay = strToDisplay + "#" + i + " " + array[i] + "<br>";
    }
    displayInModal(strToDisplay);
}

function clearLocalStoreHistory() {
    localStorage.setItem("history", JSON.stringify([]));
}
if (localStorage.getItem("history") == null) {
    localStorage.setItem("history", JSON.stringify([]));
}

/*roll oracles*/
function searchFirstTableForOracleByDisplayName(txt, oracles) {
    if (Array.isArray(oracles)) {
        for (i = 0; i < oracles.length; i++) {
            var toSearch = oracles[i];
            if (toSearch["Display name"] != null) {
                if (toSearch["Display name"] == txt) {
                    return toSearch;
                }
            }
            var toFurtherSearch = toSearch.Oracles != null ? toSearch.Oracles : toSearch.Tables;
            if (Array.isArray(toFurtherSearch)) {
                var result = searchFirstTableForOracleByDisplayName(txt, toFurtherSearch);
                if (result["Display name"] == txt) {
                    return result;
                }
            }
        }
    };
    if (oracles != null && oracles["Display name"] != null) {
        if (oracles["Display name"] == txt) {
            return oracles;
        }
    }
}
var enforceOneRoll = false;
var enforcedResult = 100;

function rollOnTable(table) {

    var randResult = Math.floor(Math.random() * 100) + 1;
    if (enforceOneRoll) {
        randResult = enforcedResult;
        enforceOneRoll = false;
    }
    for (var i = 0; i < table.length; i++) {
        var row = table[i];
        if (randResult <= row.Chance) {
            var result = row.Description;
            if (row.Details != null) {
                result = result + " Details: " + row.Details;
            }
            if (row.Thumbnail != null) {
                result = result + "<br><img src='" + row.Thumbnail + ".jpg'><br>"
            }
            if (row.Suggest != null && row.Suggest[0] != null && row.Suggest[0].Oracles != null) {
                result = result + "<div style='background-color: " + BACKGROUND_COLOR_1 + "; margin: 10px;'> Suggestions:";
                var suggestions = row.Suggest[0].Oracles;
                for (var j = 0; j < suggestions.length; j++) {
                    var suggestion = suggestions[j];
                    if (j == 0) {
                        result = result + " " + rollOnOracle(oracles[suggestion.Category][spaceToUnderscore(suggestion.Name)]);
                    } else {
                        result = result + "," + rollOnOracle(oracles[suggestion.Category][spaceToUnderscore(suggestion.Name)]);
                    }
                }
                result = result + "</div>"
            }
            if (row.Oracles != null) {
                result = result + "<div style='background-color: " + BACKGROUND_COLOR_2 + "; margin: 10px;'> Oracles:";
                var suggestions = row.Oracles;
                for (var j = 0; j < suggestions.length; j++) {
                    var suggestion = suggestions[j];
                    if (j == 0) {
                        result = result + " " + rollOnOracle(oracles[suggestion.Category][spaceToUnderscore(suggestion.Name)]);
                    } else {
                        result = result + "," + rollOnOracle(oracles[suggestion.Category][spaceToUnderscore(suggestion.Name)]);
                    }
                }
                result = result + "</div>"
            }
            if (row["Multiple rolls"] != null) {
                var multipleRolls = row["Multiple rolls"];
                result = result + "<div style='background-color: " + BACKGROUND_COLOR_3 + "; margin: 10px;'> Multiple rolls result:";
                for (var j = 0; j < multipleRolls.Amount; j++) {
                    if (j == 0) {
                        result = result + " " + rollOnTable(table);
                    } else {
                        result = result + "," + rollOnTable(table);
                    }
                }
                result = result + "</div>"
            }
            if (row.Assets != null) {
                result = result + " Assets:" + row.Assets;
            }
            if (row["Game object"] != null) { //TODO add amount
                result = result + "<div style='background-color: " + BACKGROUND_COLOR_4 + "; margin: 10px;'> Game object:";
                var gameObject = row["Game object"];
                if (gameObject["Object type"] != null) {
                    var gameObjectType = gameObject["Object type"];
                    if (gameObjectType == "Starship") {
                        result = result + " Starship: [ <br> " + createStarship(false) + "<br>]"
                    }
                    if (gameObjectType == "Character") {
                        result = result + " Character: [ <br> " + createCharacter(false) + "<br>]"
                    }
                    if (gameObjectType == "Settlement") {
                        result = result + " Settlement: [ <br> " + createSettlement(false) + "<br>]"
                    }
                    if (gameObjectType == "Planet") {
                        result = result + " Planet: [ <br> " + createPlanet(false) + "<br>]"
                    }
                    if (gameObjectType == "Precursor Vault") {
                        result = result + " Precursor Vault: [ <br> " + createPrecursorVault(false) + "<br>]"
                    }
                    if (gameObjectType == "Creature") {
                        result = result + " Creature    : [ <br> " + createCreature(false) + "<br>]"
                    }

                    result = result + "</div>"
                }
            }
            if (row["Add template"] != null) {
                var template = row["Add template"];
                var templateType = template["Template type"];
                var attributes = template.Attributes;
                var derelictType = attributes["Derelict Type"];
                result = result + " Derelict: [ <br> " + createDerelict() + "<br>]"
            }
            return result;
        }
    }
}

function rollOnOracle(oracle) {
    console.log(oracle)
    var result = "";
    if (oracle.Tables != null) {
        for (var i = 0; i < oracle.Tables.length; i++) {
            var subResult = rollOnOracle(oracle.Tables[i]);
            result = result + "<br>" + "For " + oracle.Tables[i].Name + ": " + subResult;
        }
    } else {
        result = rollOnTable(oracle.Table);
    }
    return result;
}

function createLocationFeaturesByTheme(theme) {
    return "Feature:" + rollOnOracle(oracles.Location_Theme[theme].Feature) + "<br>" +
        "Peril:" + rollOnOracle(oracles.Location_Theme[theme].Peril) + "<br>" +
        "Opportunity:" + rollOnOracle(oracles.Location_Theme[theme].Opportunity) + "<br>";
}

function createLocation(display) {
    var themeText = rollOnOracle(oracles.Location_Theme.Theme_Type);
    var theme = themeText.replace(/ .*/, '');

    var txt = "Theme " + themeText + "<br>" +
        createLocationFeaturesByTheme(theme);
    ""
    if (display == null || display) {
        displayInModal(txt);
    }
    return txt;
}

function createCharacter(display) {
    console.log("createCharacter with parameter " + display);
    var txt = rollOnOracle(oracles.Character.Given_Name) +
        " \"" +
        rollOnOracle(oracles.Character.Callsign) +
        "\" " +
        rollOnOracle(oracles.Character.Family_Name) +
        "<br>" +
        "First look: " + rollOnOracle(oracles.Character.First_Look) +
        "<br>" +
        "Disposition: " + rollOnOracle(oracles.Character.Disposition) +
        "<br>" +
        "Role: " + rollOnOracle(oracles.Character.Role) +
        "<br>" +
        "Goal: " + rollOnOracle(oracles.Character.Goal) +
        "<br>" +
        "Revealed aspect:" + rollOnOracle(oracles.Character.Revealed_Aspect)

    if (display == null || display) {
        displayInModal(txt);
    }
    return txt;
}


function createCharacterCreation(display) {
    var txt = rollOnOracle(oracles.Character_Creation.Background_Assets) +
        "<br>" +
        "Backstory Prompts: " + rollOnOracle(oracles.Character_Creation.Backstory_Prompts) +
        "<br>" +
        "<br>" +
        "Starship History: " + rollOnOracle(oracles.Character_Creation.Starship_History) +
        "<br>" +
        "Starship Quirks: " + rollOnOracle(oracles.Character_Creation.Starship_Quirks) +
        "<br>" +
        "<br>" +
        "Sector Trouble: " + rollOnOracle(oracles.Character_Creation.Sector_Trouble) +
        "<br>" +
        "Inciting Incident: " + rollOnOracle(oracles.Character_Creation.Inciting_Incident)

    if (display == null || display) {
        displayInModal(txt);
    }
    return txt;
}

function createSectorName(display) {
    var txt = "Sector name prefix: " + rollOnOracle(oracles.Space["Sector_Name_-_Prefix"]) +
        "<br>" +
        "Sector name suffix: " + rollOnOracle(oracles.Space["Sector_Name_-_Suffix"])
    if (display == null || display) {
        displayInModal(txt);
    }
    return txt;
}

function todo() {
    //enforceOneRoll = true;
    //enforcedResult = 100;
    //var txt = rollOnOracle(oracles.Starship.Starship_Type)
    //displayInModal(txt);
    alert('not implemented yed');
}

function createEnvironmentCreature(environment) {
    return "Environment: " + environment +
        "<br>" +
        "Scale: " + rollOnOracle(oracles.Creature.Scale) +
        "<br>" +
        "Basic Form: " + rollOnOracle(oracles.Creature.Basic_Form[environment]) +
        "<br>" +
        "First Look: " + rollOnOracle(oracles.Creature.First_Look) +
        "<br>" +
        "Encountered Behavior: " + rollOnOracle(oracles.Creature.Encountered_Behavior) +
        "<br>" +
        "Revealed Aspect: " + rollOnOracle(oracles.Creature.Revealed_Aspect)
}

function createSpaceCreature(display) {
    var environment = "Space";
    var txt = createEnvironmentCreature(environment);
    if (display == null || display) {
        displayInModal(txt);
    }
    return txt;
}

function createInteriorCreature(display) {
    var environment = "Interior";
    var txt = createEnvironmentCreature(environment);
    if (display == null || display) {
        displayInModal(txt);
    }
    return txt;
}

function createLandCreature(display) {
    var environment = "Land";
    var txt = createEnvironmentCreature(environment);
    if (display == null || display) {
        displayInModal(txt);
    }
    return txt;
}

function createLiquidCreature(display) {
    var environment = "Liquid";
    var txt = createEnvironmentCreature(environment);
    if (display == null || display) {
        displayInModal(txt);
    }
    return txt;
}

function createAirCreature(display) {
    var environment = "Air";
    var txt = createEnvironmentCreature(environment);
    if (display == null || display) {
        displayInModal(txt);
    }
    return txt;
}

function createPlanetFeaturesByClass(planetaryClass) {
    var planetaryClassKey = spaceToUnderscore(planetaryClass);
    return "" +
        "Name: " + pickRandomFromJsArray(oracles.Planet[planetaryClassKey]["Sample Names"]) + "<br>" +
        "Class: " + planetaryClass + "<br>" +
        "Description: " + oracles.Planet[planetaryClassKey].Description + "<br>" +
        "Atmosphere: " + rollOnOracle(oracles.Planet[planetaryClassKey].Atmosphere) + "<br>" +
        "Settlements: " + rollOnOracle(oracles.Planet[planetaryClassKey].Settlements) + "<br>" +
        "Observed From Space: " + rollOnOracle(oracles.Planet[planetaryClassKey].Observed_From_Space) + "<br>" +
        "Planetside Feature: " + rollOnOracle(oracles.Planet[planetaryClassKey].Planetside_Feature) + "<br>" +
        "Life: " + rollOnOracle(oracles.Planet[planetaryClassKey].Life) + "<br>" +

        "";
}

function createPlanet(display) {
    var planetaryClassText = cleanText(rollOnOracle(oracles.Planet.Planetary_Class));
    var planetaryClass = planetaryClassText.split(' ').slice(0, 2).join(' ');
    var txt = "<div style='background-color: " + BACKGROUND_COLOR_6 + "; margin: 10px;'>" +
        createPlanetFeaturesByClass(planetaryClass) +
        "</div>";
    if (display == null || display) {
        displayInModal(txt);
    }
    return txt;
}

function createInteriorPrecursorVault(display) {
    var txt = "<div style='background-color: " + BACKGROUND_COLOR_10 + "; margin: 10px;'>Vault Interior" + "<br>" +
        "First look: " + rollOnOracle(oracles.Precursor_Vault.Vault_Interior.First_Look) + "<br>" +
        "Feature: " + rollOnOracle(oracles.Precursor_Vault.Vault_Interior.Feature) + "<br>" +
        "Peril: " + rollOnOracle(oracles.Precursor_Vault.Vault_Interior.Peril) + "<br>" +
        "Opportunity: " + rollOnOracle(oracles.Precursor_Vault.Vault_Interior.Opportunity) + "<br>" +
        "</div>";
    if (display == null || display) {
        displayInModal(txt);
    }
    return txt;
}

function createSanctumPrecursorVault(display) {
    var txt = "<div style='background-color: " + BACKGROUND_COLOR_10 + "; margin: 10px;'>Vault Sanctum" + "<br>" +
        "Purpose: " + rollOnOracle(oracles.Precursor_Vault.Vault_Sanctum.Purpose) + "<br>" +
        "Feature: " + rollOnOracle(oracles.Precursor_Vault.Vault_Sanctum.Feature) + "<br>" +
        "Peril: " + rollOnOracle(oracles.Precursor_Vault.Vault_Sanctum.Peril) + "<br>" +
        "Opportunity: " + rollOnOracle(oracles.Precursor_Vault.Vault_Sanctum.Opportunity) + "<br>" +
        "</div>";
    if (display == null || display) {
        displayInModal(txt);
    }
    return txt;
}

function createPrecursorVault(display) {
    var txt = "<div style='background-color: " + BACKGROUND_COLOR_9 + "; margin: 10px;'> Precursor Vault:" + "<br>" +
        "Location: " + rollOnOracle(oracles.Precursor_Vault.Location) + "<br>" +
        "Scale: " + rollOnOracle(oracles.Precursor_Vault.Scale) + "<br>" +
        "Form: " + rollOnOracle(oracles.Precursor_Vault.Form) + "<br>" +
        "Shape: " + rollOnOracle(oracles.Precursor_Vault.Shape) + "<br>" +
        "Material: " + rollOnOracle(oracles.Precursor_Vault.Material) + "<br>" +
        "Outer First Look: " + rollOnOracle(oracles.Precursor_Vault.First_Look) + "<br>" +
        createInteriorPrecursorVault(false) + "<br>" +
        createSanctumPrecursorVault(false) + "<br>" +
        "</div>";
    if (display == null || display) {
        displayInModal(txt);
    }
    return txt;

}

function createSettlement(display) {
    var txt = "<div style='background-color: " + BACKGROUND_COLOR_7 + "; margin: 10px;'> Settlement:" + "<br>" +
        "Name: " + rollOnOracle(oracles.Settlement.Name) + "<br>" +
        "Location: " + rollOnOracle(oracles.Settlement.Location) + "<br>" +
        "Population: " + rollOnOracle(oracles.Settlement.Population) + "<br>" +
        "First Look: " + rollOnOracle(oracles.Settlement.First_Look) + "<br>" +
        "Authority: " + rollOnOracle(oracles.Settlement.Authority) + "<br>" +
        "Initial Contact: " + rollOnOracle(oracles.Settlement.Initial_Contact) + "<br>" +
        "Projects: " + rollOnOracle(oracles.Settlement.Projects) + "<br>" +
        "Trouble: " + rollOnOracle(oracles.Settlement.Trouble) + "<br>" +
        "</div>";
    if (display == null || display) {
        displayInModal(txt);
    }
    return txt;
}

function createCreature(display) {
    var environment = rollOnOracle(oracles.Creature.Environment);
    var txt = createEnvironmentCreature(environment);
    if (display == null || display) {
        displayInModal(txt);
    }
    return txt;
}


function createDerelictFeaturesByZone(zone) {

    var access = "";
    if (zone != 'Access') {
        var access = "Access:" + "<br>" +
            createDerelictFeaturesByZone("Access");
    }

    console.log("Zone " + zone + " " + oracles.Derelict[zone])
    var result = "Zone:" + zone + "<br>" +
        "Area:" + rollOnOracle(oracles.Derelict[zone].Area) + "<br>" +
        "Feature:" + rollOnOracle(oracles.Derelict[zone].Feature) + "<br>" +
        "Peril:" + rollOnOracle(oracles.Derelict[zone].Peril) + "<br>" +
        "Opportunity:" + rollOnOracle(oracles.Derelict[zone].Opportunity) + "<br>" +
        access;

    return result;
}

function createZoneStarship() {
    return rollOnOracle(oracles.Derelict.Zone["Derelict_Zone_-_Starship"]);
}

function createZoneSettlement() {
    return rollOnOracle(oracles.Derelict.Zone["Derelict_Zone_-_Settlement"]);
}

function createDerelictZoneByType(derelictType) {
    var result = "";
    if (derelictType == "Starship") {
        result = rollOnOracle(oracles.Derelict.Zone["Derelict_Zone_-_Starship"])
    }
    if (derelictType == "Settlement") {
        result = rollOnOracle(oracles.Derelict.Zone["Derelict_Zone_-_Settlement"])
    }

    return cleanText(result);
}

function createDerelictByLocationAndType(location, derelictType) {
    var access = "<div style='background-color: " + BACKGROUND_COLOR_5 + "; margin: 10px;'> Access:" + "<br>" +
        createDerelictFeaturesByZone("Access") +
        "</div>";
    var firstZone = "<div style='background-color: " + BACKGROUND_COLOR_5 + "; margin: 10px;'> First zone:" + "<br>" + createDerelictFeaturesByZone(createDerelictZoneByType(derelictType)) +
        "</div>"
    var secondZone = "<div style='background-color: " + BACKGROUND_COLOR_5 + "; margin: 10px;'> Second zone:" + "<br>" + createDerelictFeaturesByZone(createDerelictZoneByType(derelictType)) +
        "</div>"
    var thirdZone = "<div style='background-color: " + BACKGROUND_COLOR_5 + "; margin: 10px;'> Third zone:" + "<br>" + createDerelictFeaturesByZone(createDerelictZoneByType(derelictType)) +
        "</div>"
    return "Location: " + location + "<br>" +
        "Type: " + derelictType + "<br>" +
        "Condition: " + rollOnOracle(oracles.Derelict.Condition) + "<br>" +
        "Outer First Look: " + rollOnOracle(oracles.Derelict.Outer_First_Look) + "<br>" +
        "Inner First Look: " + rollOnOracle(oracles.Derelict.Inner_First_Look) + "<br>" +
        access + "<br>" +
        firstZone + "<br>" +
        secondZone + "<br>" +
        thirdZone + "<br>" +
        ""
}

function createDerelict(display) {
    var location = rollOnOracle(oracles.Derelict.Location);
    var derelictType = rollOnOracle(oracles.Derelict.Derelict_Type[spaceToUnderscore(location)])
    var txt = "<div style='background-color: " + BACKGROUND_COLOR_8 + "; margin: 10px;'>" +
        createDerelictByLocationAndType(location, derelictType) +
        "</div>";

    if (display == null || display) {
        displayInModal(txt);
    }
    return txt;
}

function rollActionAndTheme(display) {
    var txt =
        "Action and Theme: " +
        rollOnOracle(oracles.Core.Action) +
        " " +
        rollOnOracle(oracles.Core.Theme)
    if (display == null || display) {
        displayInModal(txt);
    }
    return txt;
}

function rollDescriptorAndFocus(display) {
    var txt =
        "Descriptor and Focus: " +
        rollOnOracle(oracles.Core.Descriptor) +
        " " +
        rollOnOracle(oracles.Core.Focus)
    if (display == null || display) {
        displayInModal(txt);
    }
    return txt;
}

function createStarship(display) {
    var txt = rollOnOracle(oracles.Starship.Name) +
        "<br>" +
        "Starship Type: " + rollOnOracle(oracles.Starship.Starship_Type) +
        "<br>" +
        "Fleet: " + rollOnOracle(oracles.Starship.Fleet) +
        "<br>" +
        "Initial Contact: " + rollOnOracle(oracles.Starship.Initial_Contact) +
        "<br>" +
        "First Look: " + rollOnOracle(oracles.Starship.First_Look)
    if (display == null || display) {
        displayInModal(txt);
    }
    return txt;
}
/*other*/


</script>